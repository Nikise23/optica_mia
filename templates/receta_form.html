{% extends 'base.html' %}

{% block title %}{{ 'Editar' if receta else 'Nueva' }} Receta · ÓpticaApp{% endblock %}

{% block content %}
<h2 class="mb-3">{{ 'Editar' if receta else 'Nueva' }} Receta</h2>
<form method="post" class="row g-3">
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Fecha</label>
    <input name="fecha" type="date" class="form-control" value="{{ receta.fecha if receta and receta.fecha else '' }}" />
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Paciente</label>
    <select name="paciente_id" class="form-select" required>
      <option value="">Seleccionar paciente</option>
      {% for p in pacientes %}
      <option value="{{ p.id }}" {% if receta and receta.paciente_id == p.id %}selected{% endif %}>
        {{ p.apellido }}, {{ p.nombre }}
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Médico</label>
    <select name="medico_id" class="form-select" required>
      <option value="">Seleccionar médico</option>
      {% for m in medicos %}
      <option value="{{ m.id }}" {% if receta and receta.medico_id == m.id %}selected{% endif %}>
        {{ m.apellido }}, {{ m.nombre }}
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Tipo de lente</label>
    <input name="tipo_lente" class="form-control" value="{{ receta.tipo_lente if receta else '' }}" />
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Medida OD</label>
    <input name="medida_od" class="form-control" value="{{ receta.medida_od if receta else '' }}" />
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Medida OS</label>
    <input name="medida_os" class="form-control" value="{{ receta.medida_os if receta else '' }}" />
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Total</label>
    <input name="total" type="number" step="0.01" min="0" class="form-control" value="{{ receta.total if receta else '' }}" />
  </div>
  <div class="col-sm-6 col-lg-3">
    <label class="form-label">Armazón</label>
    <select name="armazon_id" class="form-select">
      <option value="">Sin armazón</option>
      {% for a in armazones %}
      <option value="{{ a.id }}" {% if receta and receta.armazon_id == a.id %}selected{% endif %}>
        {{ a.codigo }} - {{ a.nombre }} (stock: {{ a.cantidad }})
      </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-12">
    <label class="form-label">Observaciones</label>
    <textarea name="observaciones" class="form-control" rows="3">{{ receta.observaciones if receta else '' }}</textarea>
  </div>
  <div class="col-12 d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{{ url_for('recetas_list') }}">Cancelar</a>
    <button class="btn btn-primary" type="submit">Guardar</button>
  </div>
</form>
{% endblock %}

